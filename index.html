<!DOCTYPE html>
<html ng-app="DrillApp" manifest="drill2.appcache">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Drill 2</title>

		<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
		<link rel="stylesheet" href="res/style.css">
		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<![endif]-->

		<!-- Libs -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.18/angular.min.js"></script>
		<script src="res/jquery.cookie-1.4.1.min.js"></script>
		<script src="res/markdown.min.js"></script>

		<!-- Custom code -->
		<script src="res/script.js"></script>
		<script src="res/controller.js"></script>
		<script src="res/localfile.js"></script>

	</head>
	<body ng-controller="DrillController">
		<nav class="timer navbar navbar-default navbar-fixed-top" role="navigation" ng-show="config.timeLimitEnabled && view.isQuestion()">
			{{currentQuestion.timeLeft | minutes}}
		</nav>

		<nav class="navbar navbar-default navbar-static-top" role="navigation">
			<div class="container">
				<div class="row">
					<div class="col-xs-12">
						<div class="navbar-header">
							<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
								<span class="sr-only">Toggle navigation</span>
								<span class="glyphicon glyphicon-wrench"></span>
							</button>
							<a href="#" class="navbar-brand">Drill 2</a>
						</div>
						<div class="collapse navbar-collapse" id="navbar">
							<ul class="nav navbar-nav pull-right text-right">
								<li><button class="btn navbar-btn" ng-click="restart()" ng-disabled="view.isFirst()">Restart test</button></li>
								<li class="distance"></li>
								<li><button class="btn navbar-btn" ng-click="reinitialize()" ng-disabled="view.isFirst() && !questions.length">Load questions</button></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</nav>

		<div class="container">
			<div class="row">

				<div class="col-sm-4 col-sm-push-8 col-md-4 col-md-push-8">
					<div class="panel panel-default">
						<div class="panel-heading">
							<h3 class="panel-title">
								<a href="#" class="collapsed" data-toggle="collapse" data-target="#collapseScore">Score: {{stats.pcScore()}}% ({{stats.score | decPlaces:2}} / {{stats.totalPoints | decPlaces:2}})</a>
							</h3>
						</div>
						<div id="collapseScore" class="panel-collapse collapse">
							<table class="table">
								<tr>
									<td>Correct:</td>
									<td><b>{{stats.correct}}</b></td>
									<td class="text-right"><b>{{stats.pcOfQuestions(stats.correct)}}%</b></td>
								</tr>
								<tr>
									<td>Partially:</td>
									<td><b>{{stats.partial}}</b></td>
									<td class="text-right"><b>{{stats.pcOfQuestions(stats.partial)}}%</b></td>
								</tr>
								<tr>
									<td>Incorrect:</td>
									<td><b>{{stats.incorrect}}</b></td>
									<td class="text-right"><b>{{stats.pcOfQuestions(stats.incorrect)}}%</b></td>
								</tr>
							</table>
						</div>
					</div>
				</div>

				<div class="modal fade" id="formatModal" role="dialog" aria-hidden="true">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
								<h4 class="modal-title">Questions database format</h4>
							</div>
							<div class="modal-body">
								<p>You have to load a question database that you want to learn from.</p>
								<p>The database is a simple text file. Questions are separated with double line breaks. Each question consists of a body (the actual question) and answers. Answers are indicated by subsequent letters and a closing bracket. Correct answers are preceded with three <i>greater than</i> characters.</p>
								<p>Example:</p>
								<pre>This is the first question. Which animal is the largest?
A) Ant &mdash; this answer is incorrect
>>>B) Male cat &mdash; correct answer
>>>C) Female cat &mdash; another correct answer
D) Spider &mdash; incorrect one

Second question. What are you?
>>>A) A man
B) A mouse</pre>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
							</div>
						</div>
					</div>
				</div>

				<div class="col-sm-8 col-sm-pull-4 col-md-8 col-md-pull-4 col-lg-7" ng-show="view.isFirst()">
					<div ng-show="!questions.length">
						<div class="page-header">
							<h2>
								Load test questions
								<small><a href="#" data-toggle="modal" data-target="#formatModal">(need help?)</a></small>
							</h2>
						</div>
						<div class="alert alert-danger" role="alert" ng-show="fileError">This file doesn't contain any valid questions.</div>
						<div ng-show="fileApiSupported">
							<p><input type="file" id="fileSelector" ng-read-text="onFileSelect($files)"></p>
							<p ng-hide="pasteEnabled">You can also <a href="#" ng-click="setPaste(true)">enter questions manually</a> if you prefer to.</p>
						</div>
						<div ng-show="pasteEnabled || !fileApiSupported">
							<p ng-hide="fileApiSupported">Your browser doesn't support File API, so loading file from your device is impossible.</p>
							<p>Paste questions below.</p>
							<form role="form">
								<div class="form-group">
									<textarea class="form-control" rows="10" ng-model="dataString"></textarea>
								</div>
								<div class="form-group">
									<button class="btn btn-link" ng-show="fileApiSupported" ng-click="setPaste(false)">Hide this field</button>
									<button class="btn btn-primary pull-right" ng-click="loadQuestions(true)">Load questions</button>
								</div>
							</form>
						</div>
					</div>

					<form name="config_form" ng-show="questions.length">
						<div class="page-header">
							<h2>
								<span title="Detected file format: {{fileFormat}}">{{questions.length}} questions loaded</span>
								<button class="btn btn-default" ng-click="reinitialize()">{{ fileApiSupported ? "Choose another file" : "Edit questions" }}</button>
							</h2>
						</div>
						<div>
							<div class="alert alert-danger" ng-show="fileFormat == 'unknown'">This file was prepared for an unrecognized version of Drill. Some features may not be available.</div>

							<div class="form-group panel panel-default panel-compact">
								<div class="panel-heading">Shuffling</div>
								<div class="panel-body">
									<div class="checkbox">
										<label>
											<input type="checkbox" ng-model="config.shuffleQuestions">
											Shuffle questions
										</label>
									</div>
									<div class="checkbox">
										<label>
											<input type="checkbox" ng-model="config.shuffleAnswers">
											Shuffle answers
										</label>
									</div>
								</div>
							</div>

							<div class="panel panel-default panel-compact">
								<div class="panel-heading">Grading</div>
								<div class="panel-body">
									<div class="form-group radio">
										<label>
											<input type="radio" name="gradingMethod" ng-model="config.gradingMethod" value="perAnswer">
											1 point for each correct answer
										</label>
									</div>
									<div class="form-group radio">
										<label>
											<input type="radio" name="gradingMethod" ng-model="config.gradingMethod" value="perQuestion">
											<div class="inline-control">
												<input type="number" min="1" max="10" name="ppq" class="form-control input-xs text-right" ng-model="config.gradingPPQ" ng-disabled="config.gradingMethod != 'perQuestion'">
											</div>
											points for entire question (fractions allowed)
										</label>
									</div>
									<hr>
									<div class="form-group radio">
										<label>
											<input type="radio" name="gradingRadical" ng-model="config.gradingRadical" value="1">
											One wrong answer zeroes score
										</label>
									</div>
									<div class="form-group radio">
										<label>
											<input type="radio" name="gradingRadical" ng-model="config.gradingRadical" value="0">
											Each wrong answer counterbalances correct one
										</label>
									</div>
								</div>
							</div>

							<div class="form-group panel panel-default panel-compact" ng-show="config.markdownReady">
								<div class="panel-heading">Markdown</div>
								<div class="panel-body">
									<div class="checkbox">
										<label>
											<input type="checkbox" ng-model="config.markdown">
											Enable Markdown formatting
										</label>
									</div>
								</div>
							</div>

							<div class="form-group panel panel-default panel-compact">
								<div class="panel-heading">Test options</div>
								<div class="panel-body">
									<div class="checkbox">
										<label>
											<input type="checkbox" ng-model="config.timeLimitEnabled">
											Time limit:
											<div class="inline-control">
												<input type="number" min="5" step="5" name="time_limit" class="form-control input-xs text-right" ng-model="config.timeLimitSecs" ng-disabled="!config.timeLimitEnabled">
											</div>
											seconds per question
										</label>
									</div>
								</div>
							</div>
						</div>
						<div class="form-group">
							<button type="button" class="btn btn-default btn-lg btn-block" ng-click="firstQuestion()" ng-disabled="config_form.ppq.$invalid || config_form.time_limit.$invalid">Begin test</button>
						</div>
					</form>
				</div>

				<div class="col-sm-8 col-sm-pull-4 col-md-8 col-md-pull-4 col-lg-7" ng-show="view.isQuestion()">
					<div class="page-header">
						<h2>Question {{questionIndex}} out of {{questions.length}}</h2>
					</div>
					<div>
						<div ng-bind-html="currentQuestion.body | markdown" ng-show="config.markdown"></div>
						<div ng-hide="config.markdown">
							<p ng-repeat="line in currentQuestion.body | lines">{{line}}</p>
						</div>
					</div>
					<form ng-submit="nextQuestion()" ng-class="{ graded: view.isGraded() }">
						<div class="form-group">
							<div class="checkbox answer correct-{{answer.correct}} checked-{{answer.checked}}" ng-repeat="answer in currentQuestion.answers | orderBy:'sortingKey'">
								<label>
									<input type="checkbox" ng-model="answer.checked" ng-disabled="view.isGraded()">
									<span>{{answer.body}}</span>
								</label>
							</div>
						</div>
						<div class="form-group">
							<button type="button" class="btn btn-default btn-lg btn-block" ng-show="view.isNotGraded()" ng-click="grade()">Check answers</button>
							<button type="submit" class="btn btn-info btn-lg btn-block" ng-show="view.isGraded() && questionIndex < questions.length">Next question</button>
							<button type="submit" class="btn btn-success btn-lg btn-block" ng-show="view.isGraded() && questionIndex >= questions.length">End test</button>
						</div>
					</form>
				</div>

				<div class="col-sm-8 col-sm-pull-4 col-md-8 col-md-pull-4 col-lg-7" ng-show="view.isFinal()">
					<div class="page-header">
						<h2>The test is over</h2>
					</div>
					<p>Here's a wrap-up of your answers:</p>
					<form class="summary">
						<div class="question panel panel-default" ng-repeat="question in questions">
							<div class="panel-body">
								<div class="question-body" ng-bind-html="question.body | markdown" ng-show="config.markdown"></div>
								<div class="question-body" ng-hide="config.markdown">
									<p ng-repeat="line in question.body | lines">{{line}}</p>
								</div>
								<div class="checkbox" ng-repeat="answer in question.answers">
									<label ng-class="{ correct: answer.checked && answer.correct, incorrect: answer.checked && !answer.correct, missed: !answer.checked && answer.correct }">
										<input type="checkbox" disabled ng-checked="answer.checked">
										{{answer.body}}
									</label>
								</div>
								<div class="text-right">
									<span>Score: {{question.grade.score | decPlaces:2}} / {{question.grade.total | decPlaces:2}}</span><br>
									<span ng-show="question.timeLeft">Time used: {{config.timeLimitSecs - question.timeLeft}} s</span>
									<span ng-hide="question.timeLeft">Time ran out.</span>
								</div>
							</div>
						</div>
					</form>
				</div>

			</div>

			<div class="row">
				<div class="col-xs-12 footer text-right">
					<p><small><a href="https://github.com/gronostajo/drill2">Drill 2</a> &bull; <a href="https://github.com/gronostajo/drill2/blob/master/LICENSE">GPL v2</a> &bull; <a href="https://github.com/gronostajo/drill2/issues">issue tracker</a></small></p>
				</div>
			</div>

		</div>

		<!-- Analytics -->
		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

			ga('create', 'UA-35145624-2', 'auto');
			ga('send', 'pageview');
		</script>
	</body>
</html>
